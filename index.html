<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Analytics Assistant</title>
  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Arial,Helvetica,sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;display:flex;align-items:center;justify-content:center}
    .container{width:100%;max-width:980px;background:#fff;border-radius:16px;box-shadow:0 15px 40px rgba(0,0,0,.15);overflow:hidden}
    .header{padding:20px;border-bottom:1px solid #eee;background:#000;color:#fff}
    .header img{height:28px}
    .chat{padding:20px;height:70vh;overflow:auto}
    .bubble{background:#f1f3f4;border-radius:14px;padding:14px 16px;margin:10px 0;max-width:70%;line-height:1.5;white-space:pre-wrap}
    .me{margin-left:auto;background:#1971ff;color:#fff}
    .sys{background:#f8f9ff}
    .input{display:flex;gap:10px;padding:16px;border-top:1px solid #eee}
    textarea{flex:1;padding:12px 14px;border:1px solid #ddd;border-radius:12px;min-height:48px;resize:vertical;font-size:16px}
    button{width:56px;height:48px;border:none;border-radius:50%;background:#1971ff;color:#fff;font-size:18px;cursor:pointer}
    .note{padding:8px 16px;color:#666;border-top:1px dashed #eee;font-size:12px;text-align:center}
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <img src="https://www.washingtonexaminer.com/wp-content/uploads/2024/05/2023-Examiner-logo-white-color-eagle-1.webp" alt="Washington Examiner"/>
    </div>

    <div id="chat" class="chat">
      <div class="bubble sys">üëã Hi! Ask about your data ‚Äî try ‚Äúshow me yesterday KPIs‚Äù, ‚Äútop referrers‚Äù, or ‚Äúbest performing authors‚Äù.</div>
    </div>

    <div class="input">
      <textarea id="msg" placeholder="Ask about your analytics data‚Ä¶"></textarea>
      <button id="send">‚û§</button>
    </div>

    <div class="note">Data refresh comes from <code>data/ga4.json</code>, <code>data/sheets.json</code>, <code>data/topics.json</code>.</div>
  </div>

  <script>
    const BACKEND_URL = 'https://wex-analytics-bot.tshkurtaj.workers.dev/query';

    const chat = document.getElementById('chat');
    const msg  = document.getElementById('msg');
    const send = document.getElementById('send');

    function add(text, me=false){
      const b = document.createElement('div');
      b.className = 'bubble' + (me ? ' me' : '');
      b.textContent = text;
      chat.appendChild(b);
      chat.scrollTop = chat.scrollHeight;
    }

    async function ask(){
      const q = msg.value.trim();
      if (!q) return;
      add(q, true);
      msg.value = '';
      try{
        const res = await fetch(BACKEND_URL, {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify({ message: q })
        });
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const data = await res.json();
        add(data.response || 'No response.');
      }catch(e){
        add('Error: ' + e.message);
      }
    }

    send.addEventListener('click', ask);
    msg.addEventListener('keydown', e => {
      if (e.key === 'Enter' && !e.shiftKey){ e.preventDefault(); ask(); }
    });
  </script>
</body>
</html>
